<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>KOTOBA-BATTLE | å¯¾æˆ¦ å®Œå…¨ç‰ˆ</title>
<style>
:root{
  --bg:#0b1227;--panel:#0f1633;--border:#1d2440;--muted:#96a7d6;--text:#eaf2ff;
  --ally:#69d3ff;--ally2:#2fb1ff;--enemy:#ff9aa5;--enemy2:#ff6b7a;
  --hp:#6bff8b;--hpBack:#12321f;--gauge:#ffe066;--gaugeBack:#342b0b;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,"Noto Sans JP",sans-serif}
button{appearance:none;cursor:pointer}
.card{background:var(--panel);border:1px solid var(--border);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
.card h2{margin:0;padding:12px 16px;border-bottom:1px solid var(--border);font-size:18px}
.card .body{padding:14px}
.container{max-width:1200px;margin:0 auto;padding:16px}

/* ã‚¿ã‚¤ãƒ—é…è‰²ï¼ˆã‚«ãƒ¼ãƒ‰èƒŒæ™¯ï¼‰ */
.t-ã‚¸ã‚ª{background:linear-gradient(180deg,#0f1730,#101f46)}
.t-ã‚¢ãƒ‹ãƒãƒ«{background:linear-gradient(180deg,#0f1c30,#132c4f)}
.t-ãƒ•ãƒ¼ãƒ‰{background:linear-gradient(180deg,#0f1a26,#1f2c46)}
.t-ã‚³ãƒ³ã‚»ãƒ—ãƒˆ{background:linear-gradient(180deg,#12182e,#1b2544)}
.t-ã‚µã‚¤ã‚¨ãƒ³ã‚¹{background:linear-gradient(180deg,#0e1d2f,#0e2c48)}
.t-ãƒ’ã‚¹ãƒˆãƒªãƒ¼{background:linear-gradient(180deg,#12172a,#1b2142)}
.t-ãƒ’ãƒ¥ãƒ¼ãƒãƒ³{background:linear-gradient(180deg,#121a28,#1e2941)}

.pill{display:inline-grid;place-items:center;width:28px;height:28px;border-radius:8px;background:#0a1430;border:1px solid #2b3a70;color:#cfe2ff;font-weight:800}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.ghost{background:transparent;border:1px dashed #2b3a70;color:#cfe2ff;padding:10px 12px;border-radius:10px}
.primary{background:linear-gradient(90deg,var(--ally),var(--ally2));color:#05203a;border:none;padding:10px 14px;border-radius:12px;font-weight:900}

/* ç·¨æˆ */
#setup{display:grid;gap:16px}
#teamGrid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.slot{display:flex;gap:8px;align-items:center}
.slot select{flex:1;background:#0b1430;border:1px solid #25366b;color:#eaf2ff;padding:10px;border-radius:10px}

#statsGrid{display:grid;gap:10px}
@media(min-width:720px){ #statsGrid{grid-template-columns:1fr 1fr} }
.statsCol{display:grid;grid-template-rows:repeat(3,auto);gap:10px}
.setupMini{background:#0b1227;border:1px solid #1a2b54;border-radius:10px;padding:8px}
.setupMini .head{display:flex;justify-content:space-between;font-weight:800}
.barLine{display:flex;align-items:center;gap:8px;margin-top:6px}
.barBox{flex:1;height:10px;background:#101c31;border:1px solid #263a6b;border-radius:6px;overflow:hidden}
.barFill{height:100%;background:var(--hp);width:0%}
.val{font-size:12px;color:#cfe2ff;width:60px;text-align:right}
.note{color:#8aa0d6}

/* ãƒãƒˆãƒ«å…¨ç”»é¢åŒ– */
body.battleMode{height:100vh;overflow:hidden}
.inSetup{display:block}
body.battleMode .inSetup{display:none}
#battle{display:none}
body.battleMode #battle{display:block}

.arena{min-height:100vh;display:grid;grid-template-rows:auto 1fr auto auto;gap:10px}
.vsrow{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.unit{border:1px solid #22325c;border-radius:12px;padding:10px;position:relative;min-height:148px}
.unit.ally{box-shadow:0 0 0 2px var(--ally) inset}
.unit.enemy{box-shadow:0 0 0 2px var(--enemy) inset}
.nameRow{display:flex;justify-content:space-between;align-items:center}
.badge{font-size:12px;background:#0d1630;border:1px solid #2b3a70;padding:2px 6px;border-radius:999px}
.meta{font-size:12px;color:#cfe2ff;margin-top:6px}

/* HP & ã‚²ãƒ¼ã‚¸ */
.hpRow{display:flex;align-items:center;gap:8px;margin-top:6px}
.hpBox{flex:1;height:12px;background:var(--hpBack);border-radius:8px;overflow:hidden;position:relative}
.hpFill{height:100%;background:var(--hp);width:0%}
.hpNum{font-size:12px;width:120px;text-align:right}
.gaugeWrap{display:flex;align-items:center;gap:8px;margin-top:4px}
.gLabel{font-size:12px;color:#ffeaa7}
.gauge{display:flex;gap:4px}
.pip{width:14px;height:12px;background:var(--gaugeBack);border:1px solid #5a480c;border-radius:3px;opacity:.7}
.pip.on{background:var(--gauge);opacity:1}
.readyPulse{animation:pulse 1.2s infinite}
@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(255,224,102,.5)}70%{box-shadow:0 0 0 12px rgba(255,224,102,0)}100%{box-shadow:0 0 0 0 rgba(255,224,102,0)}}

/* å¿…æ®ºãƒ»ç›¸æ€§ */
.skillWrap{display:grid;grid-template-columns:1fr;gap:6px;margin-top:6px}
.skillBox{border:1px solid #2c3a69;border-radius:10px;background:#0c1633;padding:8px}
.skillTitle{font-weight:900;display:flex;align-items:center;gap:6px}
.skillDesc{margin-top:4px;font-size:12px;color:#cfe2ff}
.affinityBox{border:1px solid #2c3a69;border-radius:10px;background:#0b1530;padding:6px;font-size:12px}

/* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒƒãƒ‰ */
.pad{border:1px solid #22335f;border-radius:14px;background:linear-gradient(180deg,#0d1530,#0b1428);padding:8px}
.padInner{position:relative;width:min(520px,92vw);height:210px;margin:0 auto}
.rps{position:absolute;display:grid;place-items:center;width:92px;height:92px;border-radius:999px;border:none;color:#061225}
.rps .emo{font-size:34px}.rps .lbl{font-size:12px;margin-top:2px;font-weight:800}
.rps.g{left:8%;top:8%;background:linear-gradient(180deg,#ffdfde,#ff8b8b)}
.rps.c{right:8%;top:8%;background:linear-gradient(180deg,#e0e8ff,#8bb1ff)}
.rps.p{left:50%;transform:translateX(-50%);bottom:26%;background:linear-gradient(180deg,#defae5,#8bffb5)}
.switchBtn{position:absolute;right:4%;bottom:6%;width:132px;height:56px;border-radius:14px;background:linear-gradient(90deg,#ffd89b,#fda085);border:none;color:#26110b;font-weight:900}
.spToggle{position:absolute;left:4%;bottom:6%;width:132px;height:56px;border-radius:14px;background:#0e1530;border:2px solid #f2c94c;color:#f2c94c;font-weight:900;transition:.2s}
.spToggle.on{background:linear-gradient(90deg,#ffe066,#ffcf33)!important;color:#2a1700!important;border-color:#ffcf33!important}
.spToggle:disabled{opacity:.5;filter:grayscale(.4)}

/* ãƒ™ãƒ³ãƒï¼ˆæ§ãˆï¼‰ */
.benchBar{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;justify-content:center;max-height:16vh;overflow:auto;padding:6px;border:1px dashed #2b3a70;border-radius:12px;background:#0a1733;touch-action:pan-y}
.chip{display:flex;gap:6px;align-items:center;padding:6px 10px;border:1px solid #2b3a70;background:#0b1833;border-radius:999px;font-size:12px}
.chip.good{outline:2px solid #69ffb6}

/* äº¤ä»£ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
#switchModal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;place-items:center;z-index:30}
.modalCard{background:#0f1633;border:1px solid #2b3a70;border-radius:12px;padding:14px;min-width:min(92vw,520px)}
.modalGrid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.selCard{border:1px solid #28407a;border-radius:10px;padding:10px;cursor:pointer}
.selCard.selected{outline:3px solid #69d3ff}
.modalRow{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}

/* å…­æšã¾ã¨ã‚ */
#sixStats{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.mini{border:1px solid #1a2b54;border-radius:10px;padding:8px}
.mini .head{display:flex;justify-content:space-between}
.mini .miniBar{height:8px;background:#12321f;border-radius:6px;overflow:hidden;margin-top:4px}
.mini .miniBar>span{display:block;height:100%;background:var(--hp);width:0%}

/* ã‚¿ã‚¤ãƒãƒ¼ & ãƒˆãƒ¼ã‚¹ãƒˆ */
.timer{display:flex;justify-content:center;gap:8px;align-items:center;font-weight:900}
.timer .num{font-size:28px}
.toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%) translateY(12px);padding:10px 14px;border-radius:12px;background:rgba(12,22,50,.95);border:1px solid #2b3a70;color:#eaf3ff;opacity:0;pointer-events:none;z-index:50;max-width:min(92vw,720px);line-height:1.6}
body.battleMode .toast{bottom:26vh}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);transition:.22s ease}

/* æ”»æ’ƒFX */
@keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-10px)}40%{transform:translateX(8px)}60%{transform:translateX(-6px)}80%{transform:translateX(4px)}}
.shake{animation:shake .5s ease}
.fx-burst{box-shadow:0 0 0 3px rgba(255,224,102,.7),0 0 22px 6px rgba(255,224,102,.25);transition:.2s}

/* ä¾¿åˆ© */
.hidden{display:none!important}
</style>
</head>
<body>
<div class="container inSetup" id="setup">
  <section class="card">
    <h2>ãƒãƒ¼ãƒ ç·¨æˆï¼ˆã‚ãªãŸ / CPUï¼‰</h2>
    <div class="body">
      <div id="teamGrid">
        <div>
          <div style="font-weight:900;color:var(--ally);margin-bottom:6px">ã‚ãªãŸ</div>
          <div id="teamA"></div>
        </div>
        <div>
          <div style="font-weight:900;color:var(--enemy);margin-bottom:6px">CPU</div>
          <div id="teamB"></div>
        </div>
      </div>
      <div class="row" style="margin-top:12px">
        <button id="btnRand" class="ghost">ãƒ©ãƒ³ãƒ€ãƒ ã§ãƒãƒ¼ãƒ ã‚’ç·¨æˆ</button>
        <button id="btnStart" class="primary" style="margin-left:auto">å¯¾æˆ¦é–‹å§‹</button>
      </div>
    </div>
  </section>

  <section class="card">
    <h2>é¸æŠä¸­ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h2>
    <div class="body">
      <div id="statsGrid">
        <div class="statsCol" id="statsA"></div>
        <div class="statsCol" id="statsB"></div>
      </div>
    </div>
  </section>
</div>

<!-- ãƒãƒˆãƒ« -->
<div id="battle" class="container">
  <section class="card">
    <h2 style="display:none">ãƒãƒˆãƒ«</h2>
    <div class="body">
      <div class="arena">
        <div class="vsrow">
          <div id="leftWrap"></div>
          <div id="rightWrap"></div>
        </div>

        <div class="pad">
          <div class="padInner">
            <button class="rps g" id="btnG"><div class="emo">âœŠ</div><div class="lbl">ã‚°ãƒ¼</div></button>
            <button class="rps c" id="btnC"><div class="emo">âœŒï¸</div><div class="lbl">ãƒãƒ§ã‚­</div></button>
            <button class="rps p" id="btnP"><div class="emo">ğŸ–</div><div class="lbl">ãƒ‘ãƒ¼</div></button>
            <button class="switchBtn" id="btnSwitch">ğŸ” äº¤ä»£</button>
            <button class="spToggle" id="btnSP" disabled>âœ¨ å¿…æ®º OFF</button>
          </div>
          <div class="benchBar" id="benchBar"></div>
        </div>

        <div class="timer">é¸æŠã¾ã§ <span class="num" id="countNum">15</span> ç§’</div>
        <div id="sixStats"></div>
        <div class="toast" id="toast">READY</div>
      </div>
      <div class="row" style="margin-top:10px;justify-content:space-between">
        <div id="summary" class="note">ãƒãƒˆãƒ«æº–å‚™ä¸­</div>
        <button id="btnBack" class="ghost">ç·¨æˆã«æˆ»ã‚‹</button>
      </div>
    </div>
  </section>
</div>

<!-- äº¤ä»£ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
<div id="switchModal">
  <div class="modalCard">
    <div style="font-weight:900;margin-bottom:8px">äº¤ä»£å…ˆã‚’é¸æŠ</div>
    <div class="modalGrid" id="switchGrid"></div>
    <div class="modalRow">
      <button id="swCancel" class="ghost">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button id="swDo" class="primary" disabled>äº¤ä»£ã™ã‚‹</button>
    </div>
  </div>
</div>

<script>
(()=>{"use strict";

/* ====== ä¾¿åˆ© ====== */
const $=id=>document.getElementById(id);
const MAX={HP:800,ATK:120,DEF:120,EVA:20};
const TYPES_RING=['ãƒ’ã‚¹ãƒˆãƒªãƒ¼','ã‚¸ã‚ª','ã‚³ãƒ³ã‚»ãƒ—ãƒˆ','ã‚µã‚¤ã‚¨ãƒ³ã‚¹','ã‚¢ãƒ‹ãƒãƒ«','ãƒ’ãƒ¥ãƒ¼ãƒãƒ³','ãƒ•ãƒ¼ãƒ‰'];
const typeMult=(atk,def)=>{const n=TYPES_RING.length,i=TYPES_RING.indexOf(atk),j=TYPES_RING.indexOf(def);if(i<0||j<0)return 1;const strong=[(i+1)%n,(i+2)%n],weak=[(i-1+n)%n,(i-2+n)%n];if(strong.includes(j))return 1.5;if(weak.includes(j))return 0.67;return 1;};
const TYPE_CLASS=t=>`t-${t}`;
function toast(msg){ // ã‚°ãƒ­ãƒ¼ãƒãƒ« toastï¼ˆå¯å¤‰è¡¨ç¤ºæ™‚é–“ï¼‰
  const t=$('toast'); const base=900, per=22;
  t.textContent=msg; t.classList.add('show'); clearTimeout(t._h);
  const stay=Math.min(4200, base + Math.max(0,msg.length-12)*per);
  t._h=setTimeout(()=>t.classList.remove('show'),stay);
}

/* ====== ãƒ‡ãƒ¼ã‚¿ ====== */
/* [åå‰, ãƒ©ãƒ³ã‚¯, ã‚¿ã‚¤ãƒ—, HP, ATK, DEF, EVA, å¿…æ®ºå, å¿…æ®ºèª¬æ˜] */
const WORDS=[
  /* S */
  ["ãƒ‘ãƒ©ãƒœãƒ©ã‚¢ãƒ³ãƒ†ãƒŠ","S","ã‚µã‚¤ã‚¨ãƒ³ã‚¹",560,100,85,9.0,"å¦¨å®³é›»æ³¢","æ”»æ’ƒ2.2å€ï¼‹ç›¸æ‰‹ã®ã‚²ãƒ¼ã‚¸0ã€‚"],
  ["ãƒã‚¹ã‚«ãƒ•ã‚§ã‚¢ãƒ³ãƒã‚µãƒ€ãƒ¼","S","ãƒ’ãƒ¥ãƒ¼ãƒãƒ³",540,92,90,9.5,"ä¸€æ¯ã„ã‹ãŒ","é€šå¸¸æ”»æ’ƒï¼‹å‘³æ–¹å…¨å“¡HP60å›å¾©ï¼ˆè‡ªåˆ†ã‚‚60ï¼‰ã€‚"],
  /* A */
  ["ã«ã‚“ã˜ã‚“ã—ã‚Šã—ã‚Š","A","ãƒ•ãƒ¼ãƒ‰",540,86,74,10.5,"ãªã‚“ãã‚‹ãªã„ã•ãƒ¼","æ”»æ’ƒ1.5å€ï¼‹è‡´æ­»ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’1å›ã ã‘HP1ã§è€ãˆã‚‹ã€‚"],
  ["ãã¼ã‚ã”ã¯ã‚“","A","ãƒ•ãƒ¼ãƒ‰",540,88,72,10.5,"ãã¼ã‚ä¹±èˆ","3å›æ”»æ’ƒï¼ˆ0.75â†’0.5â†’0.25ï¼‰ã€‚é€”ä¸­KOã§ã‚‚æ¬¡ã«ç¶šãã€‚"],
  ["ãƒ‹ã‚·ãƒ­ãƒ¼ãƒ©ãƒ³ãƒ‰ã‚´ãƒªãƒ©","A","ã‚¢ãƒ‹ãƒãƒ«",520,92,70,9.5,"ãƒã‚¦ãƒ³ãƒ†ãƒ³ãƒ“ãƒ¼ãƒˆ","åˆå›1.5å€ã€‚ä»¥å¾Œ2Tã¯1.3å€ã€‚"],
  ["æ¯›ã‚€ãã˜ã‚ƒã‚‰","A","ã‚¢ãƒ‹ãƒãƒ«",520,90,71,9.5,"ãƒ ã‚¯ã‚¸ãƒ£ãƒ©ãƒ©","æ”»æ’ƒ1.4å€ï¼‹å›é¿80%Ã—3Tã€‚"],
  ["ä¹å“ä»","A","ã‚¸ã‚ª",520,84,78,10.0,"ä»ã®é¡”ã‚‚ä¸‰åº¦ã¾ã§","æ”»æ’ƒ1.6å€ï¼‹è¢«ãƒ€ãƒ¡åŠæ¸›Ã—3Tã€‚"],
  ["ã‘ã‚“ã¡ã‚“æ±","A","ãƒ•ãƒ¼ãƒ‰",540,82,76,10.5,"é•·å¯¿ã®ç§˜è¨£","æ”»æ’ƒ1.2å€ï¼‹HP150å›å¾©ã€‚"],
  /* B */
  ["ã‚«ãƒ ãƒãƒ£ãƒƒã‚«åŠå³¶","B","ã‚¸ã‚ª",520,80,74,10.0,"è¨€è«–çµ±åˆ¶","4T äº¤ä»£ä¸å¯ã€‚"],
  ["ã‚¿ãƒ©ãƒ³ãƒãƒ¥ãƒ©","B","ã‚¢ãƒ‹ãƒãƒ«",520,84,70,10.5,"è¨€è‘‰ç‹©ã‚Š","1T è¡Œå‹•ä¸èƒ½ã€‚"],
  ["ãƒã‚·ãƒ“ãƒ­ã‚³ã‚¦","B","ã‚¢ãƒ‹ãƒãƒ«",520,83,71,10.0,"è¨€è«–çµ±åˆ¶","4T äº¤ä»£ä¸å¯ã€‚"],
  ["ãƒãƒ«ã‚µãƒŸã‚³é…¢","B","ãƒ•ãƒ¼ãƒ‰",520,86,69,10.5,"è¨€è«–çµ±åˆ¶","4T äº¤ä»£ä¸å¯ã€‚"],
  ["ãƒ”ãƒ­ãƒªèŒ","B","ã‚µã‚¤ã‚¨ãƒ³ã‚¹",520,82,73,10.5,"ã‚²ã‚·ãƒ¥ã‚¿ãƒ«ãƒˆå´©å£Š","4Tã€æ”»æ’ƒæ™‚33%ã§è‡ªå‚·100ã€‚"],
  ["ãƒˆãƒªãƒ‹ãƒ€ãƒ¼ãƒ‰ãƒ»ãƒˆãƒã‚´","B","ã‚¸ã‚ª",520,81,73,10.0,"è¨€è‘‰ç‹©ã‚Š","1T è¡Œå‹•ä¸èƒ½ã€‚"],
  ["ã‚«ãƒ©ãƒ¡ãƒ«è‰²ç´ ","B","ã‚µã‚¤ã‚¨ãƒ³ã‚¹",520,82,72,10.5,"ã‚²ã‚·ãƒ¥ã‚¿ãƒ«ãƒˆå´©å£Š","4Tã€æ”»æ’ƒæ™‚33%ã§è‡ªå‚·100ã€‚"],
  /* C */
  ["ãƒãƒ“ãƒ­ãƒ³æ•å›š","C","ãƒ’ã‚¹ãƒˆãƒªãƒ¼",500,76,73,11.0,"è¨€è«–çµ±åˆ¶","4T äº¤ä»£ä¸å¯ã€‚"],
  ["é³¥å–ç ‚ä¸˜","C","ã‚¸ã‚ª",500,78,72,11.0,"ã‚²ã‚·ãƒ¥ã‚¿ãƒ«ãƒˆå´©å£Š","4Tã€æ”»æ’ƒæ™‚33%ã§è‡ªå‚·100ã€‚"],
  ["ãƒ—ãƒ©ã‚·ãƒ¼ãƒœåŠ¹æœ","C","ã‚µã‚¤ã‚¨ãƒ³ã‚¹",500,79,71,11.0,"ã‚²ã‚·ãƒ¥ã‚¿ãƒ«ãƒˆå´©å£Š","4Tã€æ”»æ’ƒæ™‚33%ã§è‡ªå‚·100ã€‚"],
  ["æ¸¡æ¥äºº","C","ãƒ’ãƒ¥ãƒ¼ãƒãƒ³",500,77,73,11.0,"æ–‡å­—åŒ–ã‘","3Tå¾Œã«æˆ¦é—˜ä¸èƒ½ï¼ˆäº¤ä»£ã§è§£é™¤ï¼‰ã€‚"],
  ["ã•ã‚‹ã³ã‚ä¸¸","C","ã‚¸ã‚ª",500,77,72,11.0,"è¨€è‘‰ç‹©ã‚Š","1T è¡Œå‹•ä¸èƒ½ã€‚"],
  ["ãƒšãƒšãƒ­ãƒ³ãƒãƒ¼ãƒ","C","ãƒ•ãƒ¼ãƒ‰",500,79,71,11.0,"ã‚²ã‚·ãƒ¥ã‚¿ãƒ«ãƒˆå´©å£Š","4Tã€æ”»æ’ƒæ™‚33%ã§è‡ªå‚·100ã€‚"],
  ["ãƒãƒªãƒ—ãƒ­ãƒ”ãƒ¬ãƒ³","C","ã‚µã‚¤ã‚¨ãƒ³ã‚¹",500,80,70,11.0,"è¨€è«–çµ±åˆ¶","4T äº¤ä»£ä¸å¯ã€‚"],
  ["ã‚µãƒ©ã‚¨ãƒœäº‹ä»¶","C","ãƒ’ã‚¹ãƒˆãƒªãƒ¼",500,76,74,11.0,"è¨€è‘‰ç‹©ã‚Š","1T è¡Œå‹•ä¸èƒ½ã€‚"],
  /* D */
  ["ã‚¯ãƒãƒ³ãƒãƒ","D","ã‚¢ãƒ‹ãƒãƒ«",480,60,72,10.5,"è¨€è«–çµ±åˆ¶","4T äº¤ä»£ä¸å¯ã€‚"],
  ["çœŒåºæ‰€åœ¨åœ°","D","ã‚¸ã‚ª",480,58,75,11.0,"æ–‡å­—åŒ–ã‘","3Tå¾Œã«æˆ¦é—˜ä¸èƒ½ï¼ˆäº¤ä»£ã§è§£é™¤ï¼‰ã€‚"],
  ["ç…§ã‚Šç„¼ããƒã‚­ãƒ³","D","ãƒ•ãƒ¼ãƒ‰",480,59,74,11.0,"è¨€è«–çµ±åˆ¶","4T äº¤ä»£ä¸å¯ã€‚"],
  ["ã­ã‚‹ã­ã‚‹ã­ã‚‹ã­","D","ãƒ•ãƒ¼ãƒ‰",480,58,73,11.0,"ã‚²ã‚·ãƒ¥ã‚¿ãƒ«ãƒˆå´©å£Š","4Tã€æ”»æ’ƒæ™‚33%ã§è‡ªå‚·100ã€‚"],
  ["ã‚¹ãƒ«ãƒ¡ã‚¤ã‚«","D","ã‚¢ãƒ‹ãƒãƒ«",480,60,72,10.5,"ã‚²ã‚·ãƒ¥ã‚¿ãƒ«ãƒˆå´©å£Š","4Tã€æ”»æ’ƒæ™‚33%ã§è‡ªå‚·100ã€‚"],
  /* X */
  ["æœ¬è³ª","X","ã‚³ãƒ³ã‚»ãƒ—ãƒˆ",500,75,72,10.0,"é¡æ–‡å­—","ç›¸æ‰‹ã®èª°ã‹ã®å¿…æ®ºã‚’ã‚³ãƒ”ãƒ¼ã€‚å¨åŠ›2å€ã€‚"],
  ["è¦‹ãˆã‚‹åŒ–","X","ã‚³ãƒ³ã‚»ãƒ—ãƒˆ",500,75,72,10.0,"é¡æ–‡å­—","ç›¸æ‰‹ã®èª°ã‹ã®å¿…æ®ºã‚’ã‚³ãƒ”ãƒ¼ã€‚å¨åŠ›2å€ã€‚"],
  ["è‡ªåˆ†ã”ã¨åŒ–","X","ã‚³ãƒ³ã‚»ãƒ—ãƒˆ",500,75,72,10.0,"é¡æ–‡å­—","ç›¸æ‰‹ã®èª°ã‹ã®å¿…æ®ºã‚’ã‚³ãƒ”ãƒ¼ã€‚å¨åŠ›2å€ã€‚"],
  ["è§£åƒåº¦","X","ã‚³ãƒ³ã‚»ãƒ—ãƒˆ",500,75,72,10.0,"é¡æ–‡å­—","ç›¸æ‰‹ã®èª°ã‹ã®å¿…æ®ºã‚’ã‚³ãƒ”ãƒ¼ã€‚å¨åŠ›2å€ã€‚"]
];

/* ====== ç·¨æˆUI ====== */
const teamA=$('teamA'), teamB=$('teamB');
function makeTeam(root,side){
  root.innerHTML='';
  for(let i=0;i<3;i++){
    const div=document.createElement('div'); div.className='slot';
    const pill=document.createElement('span'); pill.className='pill'; pill.textContent='#'+(i+1);
    const sel=document.createElement('select'); sel.id=`${side}-${i}`;
    WORDS.forEach((w,idx)=>{const o=document.createElement('option');o.value=idx;o.textContent=`${w[0]} [${w[1]}/${w[2]}]`;sel.append(o);});
    sel.onchange=()=>{renderMini(side);};
    div.append(pill,sel); root.append(div);
  }
}
makeTeam(teamA,'A'); makeTeam(teamB,'B');

$('btnRand').onclick=()=>{
  const picks=()=>{
    const used=new Set(),arr=[];
    while(arr.length<3){const i=Math.floor(Math.random()*WORDS.length); if(!used.has(i)){used.add(i);arr.push(i);} }
    return arr;
  };
  const a=picks(), b=picks();
  a.forEach((v,i)=>$(`A-${i}`).value=v);
  b.forEach((v,i)=>$(`B-${i}`).value=v);
  renderMini('A'); renderMini('B'); toast('ãƒ©ãƒ³ãƒ€ãƒ ã§ãƒãƒ¼ãƒ ã‚’ç·¨æˆã—ã¾ã—ãŸ');
};

const statsA=$('statsA'), statsB=$('statsB');
function barRow(label,val,max){
  const pct=Math.max(0,Math.min(100, Math.round((val/max)*100)));
  return `<div class="barLine"><div style="width:76px;font-size:12px;color:#cfe2ff">${label}</div>
    <div class="barBox"><div class="barFill" style="width:${pct}%"></div></div>
    <div class="val">${val}</div></div>`;
}
function miniCard(idx){
  const [n,rank,typ,hp,atk,def,eva]=WORDS[idx];
  return `<div class="setupMini ${TYPE_CLASS(typ)}">
    <div class="head"><div>${n}</div><div class="badge">[${typ}]</div></div>
    ${barRow('HP',hp,MAX.HP)}${barRow('æ”»æ’ƒ',atk,MAX.ATK)}${barRow('é˜²å¾¡',def,MAX.DEF)}${barRow('å›é¿',eva,MAX.EVA)}
  </div>`;
}
function renderMini(side){
  const root= side==='A'?statsA:statsB; root.innerHTML='';
  for(let i=0;i<3;i++){ const idx=Number($(`${side}-${i}`).value)||0; root.innerHTML += miniCard(idx); }
}
renderMini('A'); renderMini('B');

/* ====== ãƒãƒˆãƒ«éƒ¨ ====== */
const state={A:{team:[],i:0,sp:0},B:{team:[],i:0,sp:0},remain:15,timer:null,spOn:false,busy:false};
const left =()=>state.A.team[state.A.i], right=()=>state.B.team[state.B.i];

$('btnStart').onclick=()=>{
  state.A.team=collect('A'); state.B.team=collect('B');
  state.A.i=0; state.B.i=0; state.A.sp=0; state.B.sp=0; state.spOn=false;
  document.body.classList.add('battleMode'); $('battle').style.display='block';
  renderSides(); buildBench(); buildSix();
  (async()=>{ toast(`ã„ã‘ã€${left().name}ï¼ãƒãƒˆãƒ«ã‚¹ã‚¿ãƒ¼ãƒˆï¼`); await delay(900); startRound(); })();
};
$('btnBack').onclick=()=>{document.body.classList.remove('battleMode'); $('battle').style.display='none'; toast('ç·¨æˆã«æˆ»ã‚Šã¾ã—ãŸ');};

function collect(side){
  const arr=[]; for(let i=0;i<3;i++){ const w=WORDS[Number($(`${side}-${i}`).value)||0]; arr.push(pack(w,side)); } return arr;
}
function pack([n,rank,typ,hp,atk,def,eva,sk,skd],side){ return {name:n,rank,type:typ,maxhp:hp,hp,atk,def,eva,skill:sk,skillDesc:skd,side}; }

function gaugeHtml(sp,sideTag){
  const pips=[...Array(6)].map((_,i)=>`<span class="pip ${i<sp?'on':''}"></span>`).join('');
  const pulse=sp>=6?'readyPulse':'';
  return `<div class="gaugeWrap"><div class="gLabel">å¿…æ®ºã‚²ãƒ¼ã‚¸</div><div class="gauge ${pulse}" id="g${sideTag}">${pips}</div></div>`;
}
function cardHtml(u,role,opp){
  const aff = typeMult(u.type,opp.type);
  const affText = aff===1.5?'ç›¸æ€§ x1.5ï¼ˆæŠœç¾¤ï¼‰': aff===0.67?'ç›¸æ€§ x0.67ï¼ˆã„ã¾ã„ã¡ï¼‰':'ç›¸æ€§ x1.0ï¼ˆç­‰å€ï¼‰';
  const sp = role==='ally'?state.A.sp:state.B.sp;
  const sideTag = role==='ally'?'A':'B';
  return `<div class="unit ${role} ${TYPE_CLASS(u.type)}" id="card-${role}">
    <div class="nameRow"><div style="font-weight:900">${u.name}</div><div class="badge">[${u.type}]</div></div>
    <div class="hpRow">
      <div class="hpBox"><div class="hpFill" id="hp-${role}" style="width:${100*u.hp/u.maxhp}%"></div></div>
      <div class="hpNum" id="hpnum-${role}">HP ${u.hp}/${u.maxhp}</div>
    </div>
    ${gaugeHtml(sp,sideTag)}
    <div class="skillWrap">
      <div class="skillBox">
        <div class="skillTitle">âœ¨ å¿…æ®ºï¼š${u.skill}</div>
        <div class="skillDesc">${u.skillDesc}</div>
      </div>
      <div class="affinityBox">${affText}</div>
    </div>
    <div class="meta">ATK ${u.atk} / DEF ${u.def} / å›é¿ ${u.eva}%</div>
  </div>`;
}
function renderSides(){
  $('leftWrap').innerHTML=cardHtml(left(),'ally',right());
  $('rightWrap').innerHTML=cardHtml(right(),'enemy',left());
  attachPop('ally',left()); attachPop('enemy',right());
  updateSPBtn();
}
function attachPop(role,u){
  $('card-'+role).onclick=()=>toast(`${u.name} åŸºç¤å€¤ï½œHP:${u.maxhp} / ATK:${u.atk} / DEF:${u.def} / å›é¿:${u.eva}%`);
}
function updateSPBtn(){
  const ready = state.A.sp>=6;
  $('btnSP').disabled=!ready;
  $('btnSP').classList.toggle('on',state.spOn);
  $('btnSP').textContent = state.spOn? 'âœ¨ å¿…æ®º ON' : 'âœ¨ å¿…æ®º OFF';
  $('gA')?.classList.toggle('readyPulse',ready);
}

function buildBench(){
  const bar=$('benchBar'); bar.innerHTML='';
  const idxs=[0,1,2].filter(i=>i!==state.A.i);
  if(!idxs.length){ bar.innerHTML='<span class="note">æ§ãˆãªã—</span>'; return; }
  idxs.forEach(i=>{
    const u=state.A.team[i], good=typeMult(u.type,right().type)>1;
    const chip=document.createElement('div'); chip.className='chip'+(good?' good':'');
    chip.innerHTML=`<span>ğŸªª ${u.name}</span><span class="badge">[${u.type}]</span>${good?'<span class="badge">ãŠã™ã™ã‚</span>':''}`;
    chip.onclick=()=>openSwitch(i);
    bar.append(chip);
  });
}
function buildSix(){
  const root=$('sixStats'); root.innerHTML='';
  const mk=(u)=>`<div class="mini"><div class="head"><div>${u.name}</div><div class="badge">[${u.type}]</div></div><div class="miniBar"><span style="width:${100*u.hp/u.maxhp}%"></span></div><div class="meta">HP ${u.hp}/${u.maxhp}</div></div>`;
  root.innerHTML += mk(left()) + mk(right());
  state.A.team.forEach((u,i)=> i!==state.A.i && (root.innerHTML += mk(u)));
  state.B.team.forEach((u,i)=> i!==state.B.i && (root.innerHTML += mk(u)));
}

/* ã‚«ã‚¦ãƒ³ãƒˆï¼†æ“ä½œ */
$('btnG').onclick=()=>pick('G');
$('btnC').onclick=()=>pick('C');
$('btnP').onclick=()=>pick('P');
$('btnSP').onclick=()=>{ if(state.A.sp>=6){ state.spOn=!state.spOn; updateSPBtn(); } };
$('btnSwitch').onclick=()=>openSwitch();

function startRound(){ state.remain=15; $('countNum').textContent=state.remain; clearInterval(state.timer);
  state.timer=setInterval(()=>{ state.remain--; $('countNum').textConte
