<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport"
      content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1,user-scalable=no">
<title>Safe Layout Build (alt)</title>
<style>
  :root{
    --bg:#0b1027; --panel:#0f1633; --ink:#eaf2ff; --muted:#9fb5ff;
    --ally:#27b1ff; --enemy:#ff6b7a;
    --hp:#63ff8c; --hpBack:#0f2a1c; --bar:#9fd4ff; --barBack:#1a2847;
    --ring:#20335f; --shadow:0 14px 38px rgba(0,0,0,.22);
    --gauge:#ffe066; --gaugeBack:#3a2d0e;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{background:var(--bg);color:var(--ink);font-family:system-ui,"Noto Sans JP",sans-serif}
  .shell{max-width:1024px;width:100vw;margin:0 auto;padding:10px}

  /* ----- å…±é€šã‚«ãƒ¼ãƒ‰ ----- */
  .card{background:var(--panel);border:1px solid var(--ring);border-radius:16px;box-shadow:var(--shadow);margin-bottom:10px}
  .card-h{padding:12px 16px;border-bottom:1px solid var(--ring);font-weight:900}
  .card-b{padding:12px 16px}

  /* ----- ãƒãƒˆãƒ«2é¢ï¼ˆå¸¸ã«1ã‚«ãƒ©ãƒ â†’ãƒ¢ãƒã‚¤ãƒ«ã§ã‚‚æ‹¡å¤§ã—ãªã„ï¼‰ ----- */
  .arena{display:grid;gap:10px}
  .vs{display:grid;gap:8px}
  @media(min-width:680px){.vs{grid-template-columns:1fr 1fr}}

  /* ----- ãƒ¦ãƒ‹ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ ----- */
  .unit{position:relative;border:1px solid #243567;border-radius:14px;padding:12px;display:grid;gap:8px}
  .owner{position:absolute;top:8px;left:8px;font-size:12px;padding:3px 10px;border-radius:999px;border:1px solid #2d3a70;background:#0b1635d8}
  .owner.ally{color:var(--ally)} .owner.enemy{color:var(--enemy)}
  .row{display:flex;justify-content:space-between;align-items:center;gap:8px}
  .badge{font-size:12px;background:#0d1630;border:1px solid #2b3a70;padding:2px 8px;border-radius:999px}
  .hpRow{display:flex;align-items:center;gap:10px}
  .hpBox{flex:1;height:22px;background:var(--hpBack);border-radius:11px;overflow:hidden}
  .hpFill{height:100%;background:var(--hp);transition:width .9s cubic-bezier(.22,.61,.36,1)}
  .hpNum{width:150px;text-align:right}
  .gWrap{display:flex;align-items:center;gap:8px}
  .gauge{display:flex;gap:4px}
  .pip{width:16px;height:12px;background:var(--gaugeBack);border:1px solid #5a480c;border-radius:3px;opacity:.7}
  .pip.on{background:var(--gauge);opacity:1}

  /* ----- ç”»åƒï¼ˆ1:1å›ºå®šã§LCPæœ€é©åŒ–ï¼‰ ----- */
  .art{width:86px;aspect-ratio:1/1;border-radius:10px;background:#0b1733;
        border:1px solid #2b3a70;display:grid;place-items:center;overflow:hidden}
  .art img{width:100%;height:100%;object-fit:contain;display:block}

  /* ----- ç›¸å¯¾ãƒãƒ¼ï¼ˆå¸¸ã«ãƒãƒ¼è‰²ï¼æ°´è‰²ï¼‰ ----- */
  .sBar{display:flex;align-items:center;gap:10px}
  .sLab{width:58px;color:#cfe2ff;font-size:12px}
  .sBox{flex:1;height:16px;background:var(--barBack);border-radius:8px;overflow:hidden}
  .sFill{height:100%;background:var(--bar)}
  .sVal{width:82px;text-align:right;font-size:12px;color:#cfe2ff}

  /* ----- æ“ä½œãƒ‘ãƒãƒ«ï¼ˆå·¦ï¼šä¸‰è§’RPS / å³ï¼šç¸¦2ãƒœã‚¿ãƒ³ï¼‰ ----- */
  .panel{display:grid;gap:12px}
  @media(min-width:680px){.panel{grid-template-columns:1fr 240px}}
  .rpsArea{background:linear-gradient(180deg,#0e1838,#0b1429);border:1px solid var(--ring);border-radius:14px;min-height:220px;position:relative}
  .rpsGrid{
      position:absolute;inset:0;display:grid;
      grid-template-columns:1fr 1fr 1fr;grid-template-rows:1fr 1fr;
      grid-template-areas:
        "g . c"
        ". p .";
      place-items:center;
  }
  .rpsBtn{
    width:96px;height:96px;border-radius:999px;border:none;cursor:pointer;
    display:grid;place-items:center;gap:2px;font-weight:900;color:#061225;
    box-shadow:0 6px 14px rgba(0,0,0,.22);
  }
  .rpsBtn .emo{font-size:36px}
  .rpsBtn .txt{font-size:12px}
  .g{grid-area:g;background:linear-gradient(180deg,#ffdfde,#ff8b8b)}
  .c{grid-area:c;background:linear-gradient(180deg,#e0e8ff,#8bb1ff)}
  .p{grid-area:p;background:linear-gradient(180deg,#defae5,#8bffb5)}
  .sideBtns{display:grid;gap:10px}
  .bigBtn{height:66px;border-radius:14px;border:none;cursor:pointer;font-weight:900}
  .sp{background:#0e1530;border:2px solid #f2c94c;color:#f2c94c}
  .sp.on{background:linear-gradient(90deg,#ffe066,#ffcf33);color:#2a1700;border-color:#ffcf33}
  .sw{background:linear-gradient(90deg,#ffd89b,#fda085);color:#26110b}

  /* ----- ãƒˆãƒ¼ã‚¹ãƒˆï¼ˆå®Œå…¨ã‚­ãƒ¥ãƒ¼ï¼‹å…¥åŠ›ãƒ­ãƒƒã‚¯ï¼‰ ----- */
  .toastHost{min-height:56px}
  .toast{margin:6px auto 0;max-width:min(96vw,720px);padding:12px 16px;border-radius:14px;
         background:rgba(12,22,50,.96);border:1px solid #2b3a70;color:#eaf3ff;
         opacity:0;transform:translateY(8px);transition:.22s ease}
  .toast.show{opacity:1;transform:translateY(0)}

  /* ã¡ã‚‡ã„FX */
  @keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-10px)}40%{transform:translateX(8px)}60%{transform:translateX(-6px)}80%{transform:translateX(4px)}}
  .shake{animation:shake .5s ease}
  .burst{box-shadow:0 0 0 3px rgba(255,224,102,.7),0 0 22px 6px rgba(255,224,102,.25)}

  /* ãƒ‡ãƒãƒƒã‚¬ï¼ˆå¿…è¦ãªã‚‰display:noneï¼‰ */
  .dbg{position:fixed;right:6px;bottom:6px;background:#0008;color:#fff;padding:6px 8px;border-radius:8px;font:12px/1.2 monospace;z-index:50}
</style>
</head>
<body>
<div class="shell">

  <!-- å¯¾æˆ¦ï¼ˆUIåœŸå°ï¼‰ -->
  <section class="card">
    <div class="card-h">ãƒãƒˆãƒ«</div>
    <div class="card-b arena">

      <!-- 2é¢ -->
      <div class="vs" id="vs">
        <!-- å·¦ -->
        <div class="unit" id="uL">
          <div class="owner ally">ã‚ãªãŸ</div>
          <div class="row">
            <div style="font-weight:900" id="nameL">â€”</div>
            <div class="badge" id="typeL">â€”</div>
          </div>
          <div class="row">
            <div class="art"><img id="imgL" alt=""></div>
            <div style="flex:1">
              <div class="hpRow">
                <div class="hpBox"><div class="hpFill" id="hpL" style="width:100%"></div></div>
                <div class="hpNum" id="hpNumL">HP â€”/â€”</div>
              </div>
              <div class="gWrap">
                <div style="font-size:12px;color:#ffeaa7">å¿…æ®ºã‚²ãƒ¼ã‚¸</div>
                <div class="gauge" id="gL"></div>
              </div>
            </div>
          </div>
          <div class="sBar"><div class="sLab">HP</div><div class="sBox"><div class="sFill" id="sL0" style="width:50%"></div></div><div class="sVal" id="svL0">â€”</div></div>
          <div class="sBar"><div class="sLab">æ”»æ’ƒ</div><div class="sBox"><div class="sFill" id="sL1" style="width:50%"></div></div><div class="sVal" id="svL1">â€”</div></div>
          <div class="sBar"><div class="sLab">é˜²å¾¡</div><div class="sBox"><div class="sFill" id="sL2" style="width:50%"></div></div><div class="sVal" id="svL2">â€”</div></div>
          <div class="sBar"><div class="sLab">å›é¿</div><div class="sBox"><div class="sFill" id="sL3" style="width:50%"></div></div><div class="sVal" id="svL3">â€”</div></div>
        </div>

        <!-- å³ -->
        <div class="unit" id="uR">
          <div class="owner enemy">CPU</div>
          <div class="row">
            <div style="font-weight:900" id="nameR">â€”</div>
            <div class="badge" id="typeR">â€”</div>
          </div>
          <div class="row">
            <div class="art"><img id="imgR" alt=""></div>
            <div style="flex:1">
              <div class="hpRow">
                <div class="hpBox"><div class="hpFill" id="hpR" style="width:100%"></div></div>
                <div class="hpNum" id="hpNumR">HP â€”/â€”</div>
              </div>
              <div class="gWrap">
                <div style="font-size:12px;color:#ffeaa7">å¿…æ®ºã‚²ãƒ¼ã‚¸</div>
                <div class="gauge" id="gR"></div>
              </div>
            </div>
          </div>
          <div class="sBar"><div class="sLab">HP</div><div class="sBox"><div class="sFill" id="sR0" style="width:50%"></div></div><div class="sVal" id="svR0">â€”</div></div>
          <div class="sBar"><div class="sLab">æ”»æ’ƒ</div><div class="sBox"><div class="sFill" id="sR1" style="width:50%"></div></div><div class="sVal" id="svR1">â€”</div></div>
          <div class="sBar"><div class="sLab">é˜²å¾¡</div><div class="sBox"><div class="sFill" id="sR2" style="width:50%"></div></div><div class="sVal" id="svR2">â€”</div></div>
          <div class="sBar"><div class="sLab">å›é¿</div><div class="sBox"><div class="sFill" id="sR3" style="width:50%"></div></div><div class="sVal" id="svR3">â€”</div></div>
        </div>
      </div>

      <!-- æ“ä½œãƒ‘ãƒãƒ« -->
      <div class="panel">
        <div class="card">
          <div class="card-h">æ“ä½œãƒ‘ãƒãƒ«</div>
          <div class="card-b rpsArea">
            <div class="rpsGrid">
              <button class="rpsBtn g" id="btnG"><div class="emo">âœŠ</div><div class="txt">ã‚°ãƒ¼</div></button>
              <button class="rpsBtn c" id="btnC"><div class="emo">âœŒï¸</div><div class="txt">ãƒãƒ§ã‚­</div></button>
              <button class="rpsBtn p" id="btnP"><div class="emo">ğŸ–</div><div class="txt">ãƒ‘ãƒ¼</div></button>
            </div>
          </div>
        </div>
        <div class="sideBtns">
          <button class="bigBtn sp" id="btnSP">âœ¨ å¿…æ®º OFF</button>
          <button class="bigBtn sw" id="btnSW">ğŸ” äº¤ä»£</button>
        </div>
      </div>

      <div class="toastHost"><div class="toast" id="toast"></div></div>
      <div style="text-align:center;font-weight:900">é¸æŠã¾ã§ <span id="sec">15</span> ç§’</div>

    </div>
  </section>

</div>

<div class="dbg" id="dbg">initâ€¦</div>

<script>
/* ========= ç”»åƒãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆdecodeã—ã¦ã‹ã‚‰è¡¨ç¤ºï¼‰ ========= */
const slug = (jp)=>({
  "ãƒ‘ãƒ©ãƒœãƒ©ã‚¢ãƒ³ãƒ†ãƒŠ":"parabola_antenna",
  "ãƒã‚¹ã‚«ãƒ•ã‚§ã‚¢ãƒ³ãƒã‚µãƒ€ãƒ¼":"nescafe_ambassador",
  "ã«ã‚“ã˜ã‚“ã—ã‚Šã—ã‚Š":"ninjin_shirishiri",
  "ãã¼ã‚ã”ã¯ã‚“":"soboro_gohan",
  "ãƒ‹ã‚·ãƒ­ãƒ¼ãƒ©ãƒ³ãƒ‰ã‚´ãƒªãƒ©":"western_lowland_gorilla",
  "æ¯›ã‚€ãã˜ã‚ƒã‚‰":"kemukujara",
  "ä¹å“ä»":"kuhonbutsu",
  "ã‘ã‚“ã¡ã‚“æ±":"kenchin_jiru",
  "ã‚«ãƒ ãƒãƒ£ãƒƒã‚«åŠå³¶":"kamchatka_peninsula",
  "ã‚¿ãƒ©ãƒ³ãƒãƒ¥ãƒ©":"tarantula",
  "ãƒã‚·ãƒ“ãƒ­ã‚³ã‚¦":"shoebill",
  "ãƒãƒ«ã‚µãƒŸã‚³é…¢":"balsamic_vinegar",
  "ãƒ”ãƒ­ãƒªèŒ":"helicobacter_pylori",
  "ãƒˆãƒªãƒ‹ãƒ€ãƒ¼ãƒ‰ãƒ»ãƒˆãƒã‚´":"trinidad_and_tobago",
  "ã‚«ãƒ©ãƒ¡ãƒ«è‰²ç´ ":"caramel_color",
  "ãƒãƒ“ãƒ­ãƒ³æ•å›š":"babylonian_captivity",
  "é³¥å–ç ‚ä¸˜":"tottori_sand_dunes",
  "ãƒ—ãƒ©ã‚·ãƒ¼ãƒœåŠ¹æœ":"placebo_effect",
  "æ¸¡æ¥äºº":"torai_jin",
  "ã•ã‚‹ã³ã‚ä¸¸":"sarubia_maru",
  "ãƒšãƒšãƒ­ãƒ³ãƒãƒ¼ãƒ":"peperoncino",
  "ãƒãƒªãƒ—ãƒ­ãƒ”ãƒ¬ãƒ³":"polypropylene",
  "ã‚µãƒ©ã‚¨ãƒœäº‹ä»¶":"sarajevo_incident",
  "ã‚¯ãƒãƒ³ãƒãƒ":"kumabachi",
  "çœŒåºæ‰€åœ¨åœ°":"prefectural_capital",
  "ç…§ã‚Šç„¼ããƒã‚­ãƒ³":"teriyaki_chicken",
  "ã­ã‚‹ã­ã‚‹ã­ã‚‹ã­":"nerunerunerune",
  "ã‚¹ãƒ«ãƒ¡ã‚¤ã‚«":"surume_ika",
  "æœ¬è³ª":"essence",
  "è¦‹ãˆã‚‹åŒ–":"mieruka",
  "è‡ªåˆ†ã”ã¨åŒ–":"jibungotoka",
  "è§£åƒåº¦":"resolution"
})[jp] || "placeholder";

async function decodeToURL(path){
  try{
    const res = await fetch(path,{cache:"reload"});
    const blob = await res.blob();
    // createImageBitmap ã¯ iOS16+ / modern chrome ã§é«˜æ€§èƒ½
    if (window.createImageBitmap){
      await createImageBitmap(blob);
    }else{
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ decode
      await new Promise((ok)=>{
        const i=new Image(); i.onload=ok; i.src=URL.createObjectURL(blob);
      });
    }
    return URL.createObjectURL(blob);
  }catch(e){
    console.warn("img decode fail", path, e);
    return path; // å¤±æ•—æ™‚ã‚‚è¡¨ç¤ºã¯è©¦ã¿ã‚‹
  }
}

/* ========= ãƒˆãƒ¼ã‚¹ãƒˆï¼ˆå®Œå…¨ã‚­ãƒ¥ãƒ¼ï¼†å…¥åŠ›ãƒ­ãƒƒã‚¯ï¼‰ ========= */
const toastQ=[]; let toastBusy=false; let inputLocked=false;
function toast(msg){
  toastQ.push(String(msg));
  if(!toastBusy) runToast();
}
function tDur(s){return 1500 + String(s).length*60;}
async function runToast(){
  toastBusy=true; lockInputs(true);
  const el=document.getElementById("toast");
  while(toastQ.length){
    const m=toastQ.shift(); el.textContent=m; el.classList.add("show");
    await new Promise(r=>setTimeout(r, tDur(m)));
    el.classList.remove("show");
    await new Promise(r=>setTimeout(r,140));
  }
  lockInputs(false);
  toastBusy=false;
}
function lockInputs(b){
  inputLocked=b;
  ["btnG","btnC","btnP","btnSP","btnSW"].forEach(id=>{
    const el=document.getElementById(id);
    el.disabled=b;
    // é€éã¯ã—ãªã„ï¼ˆè¦‹ãŸç›®ã¯ãã®ã¾ã¾ï¼‰
    el.style.pointerEvents = b ? "none" : "";
  });
}

/* ========= ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã§ã¾ãšâ€œè¦‹ãŸç›®ã ã‘â€ç¢ºèª ========= */
const L = { name:"ä¹å“ä»", type:"ã‚¸ã‚ª", hp:500, maxhp:500, atk:87, def:82, eva:11, sp:4 };
const R = { name:"ãƒˆãƒªãƒ‹ãƒ€ãƒ¼ãƒ‰ãƒ»ãƒˆãƒã‚´", type:"ã‚¸ã‚ª", hp:600, maxhp:600, atk:108, def:52, eva:8, sp:2 };
const MAX={HP:800,ATK:120,DEF:120,EVA:20};
function pct(v,m){return Math.max(0, Math.min(100, v/m*100));}
function setGauge(dom, val){dom.innerHTML = [...Array(6)].map((_,i)=>`<span class="pip ${i<val?'on':''}"></span>`).join("")}

async function paint(){
  // åå‰/ã‚¿ã‚¤ãƒ—
  nameL.textContent=L.name; typeL.textContent=L.type;
  nameR.textContent=R.name; typeR.textContent=R.type;

  // ç”»åƒï¼ˆå…ˆã«decodeï¼‰
  const lURL = await decodeToURL(`images/${slug(L.name)}.png`);
  const rURL = await decodeToURL(`images/${slug(R.name)}.png`);
  imgL.src = lURL; imgL.decoding="async"; imgL.loading="eager";
  imgR.src = rURL; imgR.decoding="async"; imgR.loading="eager";

  // HP
  hpL.style.width = (L.hp/L.maxhp*100)+"%"; hpNumL.textContent=`HP ${L.hp}/${L.maxhp}`;
  hpR.style.width = (R.hp/R.maxhp*100)+"%"; hpNumR.textContent=`HP ${R.hp}/${R.maxhp}`;

  // ç›¸å¯¾ãƒãƒ¼ï¼ˆå¸¸ã«æ°´è‰²ï¼‰
  sL0.style.width=pct(L.maxhp,MAX.HP)+"%"; svL0.textContent=L.maxhp;
  sL1.style.width=pct(L.atk,MAX.ATK)+"%"; svL1.textContent=L.atk;
  sL2.style.width=pct(L.def,MAX.DEF)+"%"; svL2.textContent=L.def;
  sL3.style.width=pct(L.eva,MAX.EVA)+"%"; svL3.textContent=L.eva+"%";
  sR0.style.width=pct(R.maxhp,MAX.HP)+"%"; svR0.textContent=R.maxhp;
  sR1.style.width=pct(R.atk,MAX.ATK)+"%"; svR1.textContent=R.atk;
  sR2.style.width=pct(R.def,MAX.DEF)+"%"; svR2.textContent=R.def;
  sR3.style.width=pct(R.eva,MAX.EVA)+"%"; svR3.textContent=R.eva+"%";

  // ã‚²ãƒ¼ã‚¸
  setGauge(gL,L.sp); setGauge(gR,R.sp);

  // ä¾‹ã®ãƒˆãƒ¼ã‚¹ãƒˆ
  toast("ã„ã‘ã€ä¹å“ä»ï¼ ãƒãƒˆãƒ«ã‚¹ã‚¿ãƒ¼ãƒˆï¼");
}

function dbg(s){document.getElementById("dbg").textContent=s;}

document.addEventListener("DOMContentLoaded", ()=>{
  // ã‚¯ãƒªãƒƒã‚¯ã¯ä»Šã¯ãƒ€ãƒŸãƒ¼ï¼šãƒ­ãƒƒã‚¯ã®æŒ™å‹•ã ã‘ä½“é¨“
  ["btnG","btnC","btnP"].forEach(id=>{
    document.getElementById(id).addEventListener("click", ()=>{
      if(inputLocked) return;
      toast("ã‚ãªãŸã¯å‡ºã—ãŸã€‚ç›¸æ‰‹ã‚‚å‡ºã—ãŸã€‚çµæœã®ãƒˆãƒ¼ã‚¹ãƒˆâ€¦");
      // ãƒ€ãƒ¡ãƒ¼ã‚¸è¡¨ç¤º â†’ ã‚·ã‚§ã‚¤ã‚¯ï¼ˆãƒŸã‚¹æ™‚ã¯æºã‚‰ã•ãªã„ï¼‰
      setTimeout(()=>{ document.getElementById("uR").classList.add("shake");
        setTimeout(()=>document.getElementById("uR").classList.remove("shake"),520);
      }, 400);
    });
  });
  document.getElementById("btnSP").addEventListener("click", ()=>{
    if(inputLocked) return;
    if (document.getElementById("btnSP").classList.toggle("on")){
      document.getElementById("btnSP").textContent="âœ¨ å¿…æ®º ON";
    }else{
      document.getElementById("btnSP").textContent="âœ¨ å¿…æ®º OFF";
    }
  });
  document.getElementById("btnSW").addEventListener("click", ()=>{
    if(inputLocked) return;
    toast("äº¤ä»£ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’ã“ã®ä½ç½®ã«å‡ºã™æƒ³å®šâ€¦ï¼ˆã“ã“ã§ã¯UIãƒ­ãƒƒã‚¯ã®ä½“é¨“ã®ã¿ï¼‰");
  });

  paint();
  dbg("layout:ready (alt build)");
});
</script>
</body>
</html>
